CREATE TABLE cliente (
	identificacion varchar NOT NULL,
	nombre varchar NOT NULL,
	apellido varchar NOT NULL,
	CONSTRAINT cliente_pk PRIMARY KEY (identificacion)
);

CREATE TABLE factura (
	id_factura int4 NOT NULL GENERATED ALWAYS AS IDENTITY,
	fecha date NOT NULL,
	descripcion varchar NULL,
	id_cliente varchar NOT NULL,
	CONSTRAINT factura_pk PRIMARY KEY (id_factura),
	CONSTRAINT factura_fk FOREIGN KEY (id_cliente) REFERENCES cliente(identificacion)
);

CREATE TABLE producto (
	id_producto int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	nombre varchar NOT NULL,
	precio_unitario float4 NOT NULL,
	CONSTRAINT producto_pk PRIMARY KEY (id_producto)
);

CREATE TABLE lote (
	id_lote int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	laboratorio varchar NOT NULL,
	fecha_vencimiento date NOT NULL,
	cantidad int4 NOT NULL,
	id_producto int4 NOT NULL,
	CONSTRAINT lote_pk PRIMARY KEY (id_lote),
	CONSTRAINT lote_fk FOREIGN KEY (id_producto) REFERENCES producto(id_producto)
);

CREATE TABLE detalle_factura (
    id_detalle int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	id_factura int4 NOT NULL,
	id_producto int4 NOT NULL,
	cantidad int4 NOT NULL,
	CONSTRAINT detalle_factura_pk PRIMARY KEY (id_detalle),
	CONSTRAINT detalle_factura_fk FOREIGN KEY (id_factura) REFERENCES factura(id_factura) ON DELETE CASCADE,
	CONSTRAINT detalle_factura_fk_1 FOREIGN KEY (id_producto) REFERENCES producto(id_producto) ON DELETE CASCADE
);
